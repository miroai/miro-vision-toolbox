
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Reference - Miro Vision Toolbox Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#image-utilities" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Miro Vision Toolbox Documentation" class="md-header__button md-logo" aria-label="Miro Vision Toolbox Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Miro Vision Toolbox Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Miro Vision Toolbox Documentation" class="md-nav__button md-logo" aria-label="Miro Vision Toolbox Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Miro Vision Toolbox Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Start Here
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        Tutorials
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../how-to-guides/" class="md-nav__link">
        How to Guides
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Reference
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#image-utilities" class="md-nav__link">
    Image Utilities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils" class="md-nav__link">
    toolbox.im_utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.get_im" class="md-nav__link">
    get_im()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.get_pil_im" class="md-nav__link">
    get_pil_im()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_3c" class="md-nav__link">
    im_3c()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_add_alpha" class="md-nav__link">
    im_add_alpha()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_apply_mask" class="md-nav__link">
    im_apply_mask()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_centre_pad" class="md-nav__link">
    im_centre_pad()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_color_mask" class="md-nav__link">
    im_color_mask()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_crop" class="md-nav__link">
    im_crop()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_draw_bbox" class="md-nav__link">
    im_draw_bbox()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_isgray" class="md-nav__link">
    im_isgray()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_mask_bbox" class="md-nav__link">
    im_mask_bbox()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_max_long_edge" class="md-nav__link">
    im_max_long_edge()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_min_short_edge" class="md-nav__link">
    im_min_short_edge()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_to_bytes" class="md-nav__link">
    im_to_bytes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_write_text" class="md-nav__link">
    im_write_text()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.image_stack" class="md-nav__link">
    image_stack()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.pil_im_gray2rgb" class="md-nav__link">
    pil_im_gray2rgb()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.propose_wh" class="md-nav__link">
    propose_wh()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.simple_im_diff" class="md-nav__link">
    simple_im_diff()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/im_utils/" class="md-nav__link">
        Image Utilities Examples
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../explanation/" class="md-nav__link">
        Explanation
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#image-utilities" class="md-nav__link">
    Image Utilities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils" class="md-nav__link">
    toolbox.im_utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.get_im" class="md-nav__link">
    get_im()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.get_pil_im" class="md-nav__link">
    get_pil_im()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_3c" class="md-nav__link">
    im_3c()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_add_alpha" class="md-nav__link">
    im_add_alpha()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_apply_mask" class="md-nav__link">
    im_apply_mask()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_centre_pad" class="md-nav__link">
    im_centre_pad()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_color_mask" class="md-nav__link">
    im_color_mask()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_crop" class="md-nav__link">
    im_crop()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_draw_bbox" class="md-nav__link">
    im_draw_bbox()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_isgray" class="md-nav__link">
    im_isgray()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_mask_bbox" class="md-nav__link">
    im_mask_bbox()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_max_long_edge" class="md-nav__link">
    im_max_long_edge()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_min_short_edge" class="md-nav__link">
    im_min_short_edge()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_to_bytes" class="md-nav__link">
    im_to_bytes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.im_write_text" class="md-nav__link">
    im_write_text()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.image_stack" class="md-nav__link">
    image_stack()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.pil_im_gray2rgb" class="md-nav__link">
    pil_im_gray2rgb()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.propose_wh" class="md-nav__link">
    propose_wh()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolbox.im_utils.simple_im_diff" class="md-nav__link">
    simple_im_diff()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Reference</h1>

<h2 id="image-utilities">Image Utilities</h2>


<div class="doc doc-object doc-module">


<a id="toolbox.im_utils"></a>
  <div class="doc doc-contents first">
  
      <p>Provide serveral Image Utility functions.</p>
<p>This module allows the user to use several of the most commonly used image handling functions at <a href="https://miro.io/">Miro AI</a>.
Some functions are documented further in the <a href="https://miroai.github.io/miro-vision-toolbox/examples/im_utils/">Example section</a>.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">toolbox.im_utils</span> <span class="kn">import</span> <span class="n">get_pil_im</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_pil_im</span><span class="p">(</span><span class="s2">&quot;https://random.imagecdn.app/500/150&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
<span class="go">(500, 150)</span>
</code></pre></div>
      <p>This module contains the following functions:</p>
<ul>
<li><code>get_pil_im(fp_url_nparray)</code>- Returns a PIL Image object from either a file path, URL, or numpy array</li>
</ul>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.get_im">
<code class="highlight language-python"><span class="n">get_im</span><span class="p">(</span><span class="n">fp_url_nparray</span><span class="p">,</span> <span class="n">b_pil_im</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>returns an image (wrapper around get_pil_im)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fp_url_nparray</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, <span title="PIL.Image">Image</span>.<span title="PIL.Image.Image">Image</span>]</code>
          </td>
          <td><p>filepath, URL, numpy array, or even an PIL Image object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>b_pil_im</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, returns a PIL Image Object</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="PIL.Image">Image</span>.<span title="PIL.Image.Image">Image</span>, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, None]</code>
          </td>
          <td><p>An Image represented either in numpy array or as an PIL Image object</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td><p>An error when fp_url_nparray cannot be converted into an image</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://random.imagecdn.app/500/150&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(150, 500, 3)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_im</span><span class="p">(</span><span class="n">fp_url_nparray</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="n">b_pil_im</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
	<span class="sd">&#39;&#39;&#39; returns an image (wrapper around get_pil_im)</span>

<span class="sd">	Args:</span>
<span class="sd">		fp_url_nparray: filepath, URL, numpy array, or even an PIL Image object</span>
<span class="sd">		b_pil_im: if True, returns a PIL Image Object</span>

<span class="sd">	Returns:</span>
<span class="sd">		An Image represented either in numpy array or as an PIL Image object</span>

<span class="sd">	Raises:</span>
<span class="sd">		ValueError: An error when fp_url_nparray cannot be converted into an image</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; get_im(&quot;https://random.imagecdn.app/500/150&quot;).shape</span>
<span class="sd">		(150, 500, 3)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">pil_im</span> <span class="o">=</span> <span class="n">get_pil_im</span><span class="p">(</span><span class="n">fp_url_nparray</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">pil_im</span> <span class="k">if</span> <span class="n">b_pil_im</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pil_im</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.get_pil_im">
<code class="highlight language-python"><span class="n">get_pil_im</span><span class="p">(</span><span class="n">fp_url_nparray</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>return a PIL image object</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fp_url_nparray</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, <span title="PIL.Image">Image</span>.<span title="PIL.Image.Image">Image</span>]</code>
          </td>
          <td><p>filepath, URL, numpy array, or even an PIL Image object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="PIL.Image">Image</span>.<span title="PIL.Image.Image">Image</span>, None]</code>
          </td>
          <td><p>A PIL Image object</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td><p>An error when fp_url_nparray cannot be converted into an image</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">get_pil_im</span><span class="p">(</span><span class="s2">&quot;https://random.imagecdn.app/500/150&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
<span class="go">(500, 150)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_pil_im</span><span class="p">(</span><span class="n">fp_url_nparray</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
	<span class="sd">&#39;&#39;&#39; return a PIL image object</span>

<span class="sd">	Args:</span>
<span class="sd">		fp_url_nparray: filepath, URL, numpy array, or even an PIL Image object</span>

<span class="sd">	Returns:</span>
<span class="sd">		A PIL Image object</span>

<span class="sd">	Raises:</span>
<span class="sd">		ValueError: An error when fp_url_nparray cannot be converted into an image</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; get_pil_im(&quot;https://random.imagecdn.app/500/150&quot;).size</span>
<span class="sd">		(500, 150)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="kn">import</span> <span class="nn">urllib.request</span> <span class="k">as</span> <span class="nn">urllib</span>
	<span class="kn">from</span> <span class="nn">urllib.error</span> <span class="kn">import</span> <span class="n">HTTPError</span><span class="p">,</span> <span class="n">URLError</span>

	<span class="n">im</span> <span class="o">=</span> <span class="n">fp_url_nparray</span>
	<span class="n">pil_im</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">):</span>
		<span class="n">pil_im</span> <span class="o">=</span> <span class="n">im</span>
	<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">im</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
		<span class="n">pil_im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">im</span><span class="p">):</span>
		<span class="n">pil_im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">validators</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="n">im</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">r</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s2">&quot;Miro&#39;s Magic Image Broswer&quot;</span><span class="p">})</span>
			<span class="n">con</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
			<span class="n">pil_im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
		<span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;get_pil_im: error getting </span><span class="si">{</span><span class="n">im</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;get_pil_im: URL error using </span><span class="si">{</span><span class="n">im</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;get_im: im must be np array, filename, or url&#39;</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">pil_im</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_3c">
<code class="highlight language-python"><span class="n">im_3c</span><span class="p">(</span><span class="n">im</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>returns a 3-channel (rgb) image in numpy array</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array of shape: (h, w, 3)</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300?grayscale&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_3c</span><span class="p">(</span><span class="n">im</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(300, 200, 3)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_3c</span><span class="p">(</span><span class="n">im</span><span class="p">:</span><span class="n">Any</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39;returns a 3-channel (rgb) image in numpy array</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>

<span class="sd">	Returns:</span>
<span class="sd">		a numpy array of shape: (h, w, 3)</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im = get_im(&quot;https://picsum.photos/200/300?grayscale&quot;)</span>
<span class="sd">		&gt;&gt;&gt; im_3c(im).shape</span>
<span class="sd">		(300, 200, 3)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">im_rgb_array</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">im_isgray</span><span class="p">(</span><span class="n">im_rgb_array</span><span class="p">,</span> <span class="n">b_check_rgb</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
		<span class="n">im</span> <span class="o">=</span> <span class="n">pil_im_gray2rgb</span><span class="p">(</span><span class="n">get_pil_im</span><span class="p">(</span><span class="n">im_rgb_array</span><span class="p">))</span>
		<span class="n">im_rgb_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">im_rgb_array</span><span class="p">[:,:,:</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_add_alpha">
<code class="highlight language-python"><span class="n">im_add_alpha</span><span class="p">(</span><span class="n">im</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>add an <strong>empty alpha channel</strong> for a  3-channel image</p>
<p>for adding an alpha channel with an actual mask, see <code>im_apply_mask</code></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array of shape: (h, w, 4)</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>AssertionError</code>
          </td>
          <td><p>An error will be raise if numpy array is not of shape (h,w,3)</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_add_alpha</span><span class="p">(</span><span class="n">im</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(300, 200, 4)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_add_alpha</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; add an **empty alpha channel** for a  3-channel image</span>

<span class="sd">	for adding an alpha channel with an actual mask, see `im_apply_mask`</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>

<span class="sd">	Returns:</span>
<span class="sd">		a numpy array of shape: (h, w, 4)</span>

<span class="sd">	Raises:</span>
<span class="sd">		AssertionError: An error will be raise if numpy array is not of shape (h,w,3)</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im = get_im(&quot;https://picsum.photos/200/300&quot;)</span>
<span class="sd">		&gt;&gt;&gt; im_add_alpha(im).shape</span>
<span class="sd">		(300, 200, 4)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">im_rgb_array</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
	<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">im_rgb_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;im_rgb_array shape is only length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">im_rgb_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
	<span class="n">h</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">im_rgb_array</span><span class="o">.</span><span class="n">shape</span>
	<span class="k">assert</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;im_rgb_array mmust be 3-channel, found </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1"> channels&#39;</span>
	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
			<span class="n">im_rgb_array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="mi">254</span>
			<span class="p">),</span> <span class="n">axis</span> <span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_apply_mask">
<code class="highlight language-python"><span class="n">im_apply_mask</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">,</span> <span class="n">mask_gblur_radius</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bg_rgb_tup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bg_blur_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bg_greyscale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>our more advanced image operation with mask <a href="https://stackoverflow.com/questions/47723154/how-to-use-pil-paste-with-mask">implemented using PIL</a></p>
<p>With a mask, this function can create four different effects:
background blurring, background removal (replace with a solid color),
greyscaling background, and creating a 4-channel image.
Additionally, a blur can be applied to the given mask to
soften the edges. For details on picking a sensible blur radius
<a href="https://stackoverflow.com/questions/62968174/for-pil-imagefilter-gaussianblur-how-what-kernel-is-used-and-does-the-radius-par">see here</a>.
Note that <strong>only ONE</strong> of <code>[bg_rgb_tup, bg_blur_radius, bg_greyscale]</code>
should be provided.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mask_array</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array that should be of the same width-height as <code>im</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mask_gblur_radius</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>mask's gaussian blur radius to soften the edges of the mask. <a href="https://stackoverflow.com/questions/62273005/compositing-images-by-blurred-mask-in-numpy">Implemented using PIL</a>, defaults to 0 (i.e. no blur applied).</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>bg_rgb_tup</code></td>
          <td>
                <code><span title="typing.Tuple">Tuple</span>[int, int, int]</code>
          </td>
          <td><p>if given, return a 3-channel image with color background instead of transparent</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>bg_blur_radius</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>if given, return a 3-channel image with GaussianBlur applied to the background</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>bg_greyscale</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>color of the background (part outside the mask) in RGB</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array in the shape of (h, w, 3) if <code>bg_rgb_tup</code> or <code>bg_blur_radius</code> or <code>bg_greyscale</code> is provided; otherwise a numpy array of shape (h, w, 4) will be returned.</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>AssertionError</code>
          </td>
          <td><p>An error will be raise if image's width-height is not the same as the mask's width-height, or if more than one of <code>[bg_rgb_tup, bg_blur_radius, bg_greyscale]</code> are provided.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span> <span class="mi">50</span><span class="p">:</span><span class="mi">150</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_masked_green</span> <span class="o">=</span> <span class="n">im_apply_mask</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">mask_array</span> <span class="o">=</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bg_rgb_tup</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">205</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_masked_gs</span> <span class="o">=</span> <span class="n">im_apply_mask</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">mask_array</span> <span class="o">=</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bg_greyscale</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_masked_blur</span> <span class="o">=</span> <span class="n">im_apply_mask</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">mask_array</span> <span class="o">=</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bg_blur_radius</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">mask_gblur_radius</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_masked_vanilla</span> <span class="o">=</span> <span class="n">im_apply_mask</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">mask_array</span> <span class="o">=</span> <span class="n">mask</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simple_im_diff</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">im_masked_green</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simple_im_diff</span><span class="p">(</span><span class="n">im_masked_green</span><span class="p">,</span> <span class="n">im_masked_gs</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simple_im_diff</span><span class="p">(</span><span class="n">im_masked_gs</span><span class="p">,</span> <span class="n">im_masked_blur</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_masked_gs</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">im_masked_vanilla</span><span class="o">.</span><span class="n">shape</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_masked_vanilla</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(300, 200, 4)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_apply_mask</span><span class="p">(</span><span class="n">im</span> <span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mask_gblur_radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">bg_rgb_tup</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bg_blur_radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
		<span class="n">bg_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
	<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; our more advanced image operation with mask [implemented using PIL](https://stackoverflow.com/questions/47723154/how-to-use-pil-paste-with-mask)</span>

<span class="sd">	With a mask, this function can create four different effects:</span>
<span class="sd">	background blurring, background removal (replace with a solid color),</span>
<span class="sd">	greyscaling background, and creating a 4-channel image.</span>
<span class="sd">	Additionally, a blur can be applied to the given mask to</span>
<span class="sd">	soften the edges. For details on picking a sensible blur radius</span>
<span class="sd">	[see here](https://stackoverflow.com/questions/62968174/for-pil-imagefilter-gaussianblur-how-what-kernel-is-used-and-does-the-radius-par).</span>
<span class="sd">	Note that **only ONE** of `[bg_rgb_tup, bg_blur_radius, bg_greyscale]`</span>
<span class="sd">	should be provided.</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		mask_array: a numpy array that should be of the same width-height as `im`</span>
<span class="sd">		mask_gblur_radius: mask&#39;s gaussian blur radius to soften the edges of the mask. [Implemented using PIL](https://stackoverflow.com/questions/62273005/compositing-images-by-blurred-mask-in-numpy), defaults to 0 (i.e. no blur applied).</span>
<span class="sd">		bg_rgb_tup: if given, return a 3-channel image with color background instead of transparent</span>
<span class="sd">		bg_blur_radius: if given, return a 3-channel image with GaussianBlur applied to the background</span>
<span class="sd">		bg_greyscale: color of the background (part outside the mask) in RGB</span>

<span class="sd">	Returns:</span>
<span class="sd">		a numpy array in the shape of (h, w, 3) if `bg_rgb_tup` or `bg_blur_radius` or `bg_greyscale` is provided; otherwise a numpy array of shape (h, w, 4) will be returned.</span>

<span class="sd">	Raises:</span>
<span class="sd">		AssertionError: An error will be raise if image&#39;s width-height is not the same as the mask&#39;s width-height, or if more than one of `[bg_rgb_tup, bg_blur_radius, bg_greyscale]` are provided.</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im = get_im(&quot;https://picsum.photos/200/300&quot;)</span>
<span class="sd">		&gt;&gt;&gt; mask = np.zeros(im.shape[:2], dtype = np.uint8)</span>
<span class="sd">		&gt;&gt;&gt; mask[100:200, 50:150] = 1</span>
<span class="sd">		&gt;&gt;&gt; im_masked_green = im_apply_mask(im, mask_array = mask, bg_rgb_tup = (50,205,50))</span>
<span class="sd">		&gt;&gt;&gt; im_masked_gs = im_apply_mask(im, mask_array = mask, bg_greyscale = True)</span>
<span class="sd">		&gt;&gt;&gt; im_masked_blur = im_apply_mask(im, mask_array = mask, bg_blur_radius = 5, mask_gblur_radius = 2)</span>
<span class="sd">		&gt;&gt;&gt; im_masked_vanilla = im_apply_mask(im, mask_array = mask)</span>
<span class="sd">		&gt;&gt;&gt; simple_im_diff(im, im_masked_green)</span>
<span class="sd">		True</span>
<span class="sd">		&gt;&gt;&gt; simple_im_diff(im_masked_green, im_masked_gs)</span>
<span class="sd">		True</span>
<span class="sd">		&gt;&gt;&gt; simple_im_diff(im_masked_gs, im_masked_blur)</span>
<span class="sd">		True</span>
<span class="sd">		&gt;&gt;&gt; im_masked_gs.shape != im_masked_vanilla.shape</span>
<span class="sd">		True</span>
<span class="sd">		&gt;&gt;&gt; im_masked_vanilla.shape</span>
<span class="sd">		(300, 200, 4)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">im_rgb_array</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
	<span class="n">p_im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">im_rgb_array</span><span class="p">)</span>
	<span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">im_rgb_array</span><span class="o">.</span><span class="n">shape</span>
	<span class="k">assert</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="n">mask_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> \
		<span class="sa">f</span><span class="s2">&quot;mask_array height-width </span><span class="si">{</span><span class="n">mask_array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> must match im_rgb_array&#39;s </span><span class="si">{</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
	<span class="k">assert</span> <span class="ow">not</span><span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">bg_rgb_tup</span><span class="p">,</span> <span class="n">bg_blur_radius</span><span class="p">,</span> <span class="n">bg_greyscale</span><span class="p">])),</span> \
		<span class="sa">f</span><span class="s2">&quot;only one of bg_rgb_tup, bg_blur_radius, or bg_greyscale call be specified.&quot;</span>

	<span class="c1"># convert bitwise mask from np to pillow</span>
	<span class="c1"># ref: https://note.nkmk.me/en/python-pillow-paste/</span>
	<span class="n">pil_mask</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="mi">255</span><span class="o">*</span> <span class="n">mask_array</span><span class="p">))</span>
	<span class="n">pil_mask</span> <span class="o">=</span> <span class="n">pil_mask</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
					<span class="n">ImageFilter</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">radius</span> <span class="o">=</span> <span class="n">mask_gblur_radius</span><span class="p">)</span>
				<span class="p">)</span> <span class="k">if</span> <span class="n">mask_gblur_radius</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">pil_mask</span>

	<span class="k">if</span> <span class="n">bg_rgb_tup</span><span class="p">:</span>
		<span class="n">bg_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="c1"># black</span>
		<span class="n">bg_im</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">bg_rgb_tup</span>						<span class="c1"># apply color</span>

		<span class="n">bg_im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">bg_im</span><span class="p">)</span>
		<span class="n">bg_im</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">p_im</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">pil_mask</span><span class="p">)</span>
		<span class="n">p_im</span> <span class="o">=</span> <span class="n">bg_im</span>
	<span class="k">elif</span> <span class="n">bg_blur_radius</span><span class="p">:</span>
		<span class="n">bg_im</span> <span class="o">=</span> <span class="n">p_im</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
					<span class="n">ImageFilter</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">radius</span> <span class="o">=</span> <span class="n">bg_blur_radius</span><span class="p">)</span>
				<span class="p">)</span>
		<span class="n">bg_im</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">p_im</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">pil_mask</span><span class="p">)</span>
		<span class="n">p_im</span> <span class="o">=</span> <span class="n">bg_im</span>
	<span class="k">elif</span> <span class="n">bg_greyscale</span><span class="p">:</span>
		<span class="n">bg_im</span> <span class="o">=</span> <span class="n">ImageOps</span><span class="o">.</span><span class="n">grayscale</span><span class="p">(</span><span class="n">p_im</span><span class="p">)</span>
		<span class="n">bg_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bg_im</span><span class="p">)</span>
		<span class="n">bg_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">bg_im</span><span class="p">,)</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> 	<span class="c1"># greyscale 1-channel to 3-channel</span>

		<span class="n">bg_im</span> <span class="o">=</span>  <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">bg_im</span><span class="p">)</span>
		<span class="n">bg_im</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">p_im</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">pil_mask</span><span class="p">)</span>
		<span class="n">p_im</span> <span class="o">=</span> <span class="n">bg_im</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">p_im</span><span class="o">.</span><span class="n">putalpha</span><span class="p">(</span><span class="n">pil_mask</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_im</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># def mask_overlap(base_mask, over_mask, get_overlap_mask = False):</span>
<span class="c1"># 	&#39;&#39;&#39;</span>
<span class="c1"># 	compute the percentage of mask union</span>
<span class="c1"># 	Args:</span>
<span class="c1"># 		get_overlap_mask: if true it will return a mask of only the union</span>
<span class="c1"># 	&#39;&#39;&#39;</span>
<span class="c1"># 	if base_mask.shape != over_mask.shape:</span>
<span class="c1"># 		raise ValueError(f&#39;mask_overlap: base_mask shape {base_mask.shape} does not match over_mask {over_mask.shape}&#39;)</span>
<span class="c1">#</span>
<span class="c1"># 	overlap = np.logical_and(base_mask!= 0, over_mask != 0)</span>
<span class="c1"># 	score = (overlap== True).sum() / np.count_nonzero(base_mask)</span>
<span class="c1"># 	return overlap.astype(np.uint8) if get_overlap_mask else float(score)</span>
<span class="c1">#</span>
<span class="c1"># def join_binary_masks(list_of_np_binary_masks):</span>
<span class="c1"># 	l_masks = list_of_np_binary_masks</span>
<span class="c1"># 	for mk in l_masks:</span>
<span class="c1"># 		if mk.shape != l_masks[0].shape:</span>
<span class="c1"># 			raise ValueError(f&#39;join_binary_masks: all masks must be of the same shape&#39;)</span>
<span class="c1">#</span>
<span class="c1"># 	out_mask = l_masks[0]</span>
<span class="c1"># 	for mk in l_masks[1:]:</span>
<span class="c1"># 		out_mask += mk</span>
<span class="c1"># 	return np.array(out_mask!=0).astype(np.uint8)</span>
<span class="c1">#</span>
<span class="c1"># def mask_bbox(input_mask, get_json = False):</span>
<span class="c1"># 	&#39;&#39;&#39;</span>
<span class="c1"># 	get the minimum bounding box of a np binary mask</span>
<span class="c1"># 	returns y0,y1,x0,x1</span>
<span class="c1"># 	&#39;&#39;&#39;</span>
<span class="c1"># 	rows = np.any(input_mask, axis=1) # y-axis</span>
<span class="c1"># 	cols = np.any(input_mask, axis=0) # x-axis</span>
<span class="c1"># 	rmin, rmax = np.where(rows)[0][[0, -1]]</span>
<span class="c1"># 	cmin, cmax = np.where(cols)[0][[0, -1]]</span>
<span class="c1"># 	rmin, rmax, cmin, cmax = list(map(int,[rmin,rmax,cmin,cmax]))</span>
<span class="c1"># 	return {&#39;x0&#39;: cmin, &#39;x1&#39;: cmax, &#39;y0&#39;: rmin, &#39;y1&#39;: rmax} if get_json else (rmin, rmax, cmin, cmax)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># def plot_colors(hist, centroids, w= 300 , h = 50):</span>
<span class="c1"># 	&#39;&#39;&#39;</span>
<span class="c1"># 	return a pil_im of color given in centroids</span>
<span class="c1"># 	&#39;&#39;&#39;</span>
<span class="c1"># 	# initialize the bar chart representing the relative frequency of each of the colors</span>
<span class="c1"># 	bar = np.zeros((50, 300, 3), dtype = &quot;uint8&quot;)</span>
<span class="c1"># 	startX = 0</span>
<span class="c1">#</span>
<span class="c1"># 	im = Image.new(&#39;RGB&#39;, (300, 50), (128, 128, 128))</span>
<span class="c1"># 	draw = ImageDraw.Draw(im)</span>
<span class="c1">#</span>
<span class="c1"># 	# loop over the percentage of each cluster and the color of</span>
<span class="c1"># 	# each cluster</span>
<span class="c1"># 	for (percent, color) in zip(hist, centroids):</span>
<span class="c1"># 		# plot the relative percentage of each cluster</span>
<span class="c1"># 		endX = startX + (percent * 300)</span>
<span class="c1"># 		xy = (int(startX), 0, int(endX), 50)</span>
<span class="c1"># 		fill = tuple(color.astype(&#39;uint8&#39;).tolist())</span>
<span class="c1"># 		draw.rectangle(xy, fill)</span>
<span class="c1"># 		startX = endX</span>
<span class="c1">#</span>
<span class="c1"># 	# return the bar chart</span>
<span class="c1"># 	im.resize( (w,h))</span>
<span class="c1"># 	return im</span>
<span class="c1">#</span>
<span class="c1"># def gamma_adjust(pil_im, gamma = 1):</span>
<span class="c1"># 	&#39;&#39;&#39;</span>
<span class="c1"># 	return a PIL Image with gamma correction (brightness)</span>
<span class="c1"># 	see: https://www.pyimagesearch.com/2015/10/05/opencv-gamma-correction/</span>
<span class="c1"># 	and code: https://note.nkmk.me/en/python-numpy-image-processing/</span>
<span class="c1"># 	&#39;&#39;&#39;</span>
<span class="c1"># 	im = np.array(pil_im)</span>
<span class="c1"># 	im_out = 255.0 * (im/ 255.0)**(1/gamma)</span>
<span class="c1"># 	return Image.fromarray(im_out.astype(np.uint8))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_centre_pad">
<code class="highlight language-python"><span class="n">im_centre_pad</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">target_wh</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>resize an image to target_wh while keeping aspect ratio by <a href="https://jdhao.github.io/2017/11/06/resize-image-to-square-with-padding/">padding the borders to keep it centered</a></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target_wh</code></td>
          <td>
                <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
          </td>
          <td><p>target width height in a Tuple</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_centre_pad</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">target_wh</span> <span class="o">=</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">300</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(300, 300, 3)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_centre_pad</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">target_wh</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39;resize an image to target_wh while keeping aspect ratio by [padding the borders to keep it centered](https://jdhao.github.io/2017/11/06/resize-image-to-square-with-padding/)</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		target_wh: target width height in a Tuple</span>

<span class="sd">	Returns:</span>
<span class="sd">		a numpy array</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im = get_im(&quot;https://picsum.photos/200/300&quot;)</span>
<span class="sd">		&gt;&gt;&gt; im_centre_pad(im, target_wh = (300,300)).shape</span>
<span class="sd">		(300, 300, 3)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">p_im</span> <span class="o">=</span> <span class="n">get_pil_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
	<span class="n">org_wh</span> <span class="o">=</span> <span class="n">p_im</span><span class="o">.</span><span class="n">size</span>
	<span class="n">ratio</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">target_wh</span><span class="p">)</span><span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">org_wh</span><span class="p">)</span>
	<span class="n">new_wh</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">org_wh</span><span class="p">])</span>
	<span class="n">p_im</span> <span class="o">=</span> <span class="n">p_im</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">new_wh</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span>
	<span class="n">out_im</span> <span class="o">=</span>  <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">target_wh</span><span class="p">)</span>

	<span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">target_wh</span>
	<span class="n">w_</span><span class="p">,</span> <span class="n">h_</span> <span class="o">=</span> <span class="n">new_wh</span>
	<span class="n">paste_xy</span> <span class="o">=</span> <span class="p">((</span><span class="n">w</span><span class="o">-</span><span class="n">w_</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">h_</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
	<span class="n">out_im</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">p_im</span><span class="p">,</span> <span class="n">paste_xy</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">out_im</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_color_mask">
<code class="highlight language-python"><span class="n">im_color_mask</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">,</span> <span class="n">rgb_tup</span><span class="o">=</span><span class="p">(</span><span class="mi">91</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">188</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>draw mask over the input image</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mask_array</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array that should be of the same width-height as <code>im</code></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>rgb_tup</code></td>
          <td>
                <code><span title="typing.Tuple">Tuple</span>[int, int, int]</code>
          </td>
          <td><p>color of the mask in RGB</p></td>
          <td>
                <code>(91, 86, 188)</code>
          </td>
        </tr>
        <tr>
          <td><code>alpha</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>level of transparency 0 being totally transparent, 1 solid color</p></td>
          <td>
                <code>0.5</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array in the shape of (h, w, 3)</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>AssertionError</code>
          </td>
          <td><p>An error will be raise if image's width-height is not the same as the mask's width-height</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_masked</span> <span class="o">=</span> <span class="n">im_color_mask</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">mask_array</span> <span class="o">=</span> <span class="n">mask</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simple_im_diff</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">im_masked</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_masked</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span>
<span class="go">True</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_color_mask</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
		<span class="n">rgb_tup</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">91</span><span class="p">,</span><span class="mi">86</span><span class="p">,</span><span class="mi">188</span><span class="p">),</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
	<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; draw mask over the input image</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		mask_array: a numpy array that should be of the same width-height as `im`</span>
<span class="sd">		rgb_tup: color of the mask in RGB</span>
<span class="sd">		alpha: level of transparency 0 being totally transparent, 1 solid color</span>

<span class="sd">	Returns:</span>
<span class="sd">		a numpy array in the shape of (h, w, 3)</span>

<span class="sd">	Raises:</span>
<span class="sd">		AssertionError: An error will be raise if image&#39;s width-height is not the same as the mask&#39;s width-height</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im = get_im(&quot;https://picsum.photos/200/300&quot;)</span>
<span class="sd">		&gt;&gt;&gt; mask = np.ones(im.shape[:2], dtype = np.uint8)</span>
<span class="sd">		&gt;&gt;&gt; im_masked = im_color_mask(im, mask_array = mask)</span>
<span class="sd">		&gt;&gt;&gt; simple_im_diff(im, im_masked)</span>
<span class="sd">		True</span>
<span class="sd">		&gt;&gt;&gt; im_masked.shape == im.shape</span>
<span class="sd">		True</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">im_rgb_array</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
	<span class="k">assert</span> <span class="n">im_rgb_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">mask_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> \
		<span class="sa">f</span><span class="s1">&#39;image is shape </span><span class="si">{</span><span class="n">im_rgb_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1"> which is different than mask shape </span><span class="si">{</span><span class="n">mask_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>

	<span class="n">bg_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">im_rgb_array</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="c1"># create color</span>
	<span class="n">bg_im</span><span class="p">[:,:]</span><span class="o">=</span> <span class="n">rgb_tup</span>
	<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">composite</span><span class="p">(</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">bg_im</span><span class="p">),</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">im_rgb_array</span><span class="p">),</span>
						<span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">mask_array</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="mi">255</span><span class="p">))</span>
						<span class="p">)</span>
	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_crop">
<code class="highlight language-python"><span class="n">im_crop</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>crops an image (numpy array) given a bounding box coordinates</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>x0</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>top left x value</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y0</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>top left y value</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>x1</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>bottom right x value</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y1</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>bottom right y value</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>An Image representation in an numpy array</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>AssertionError</code>
          </td>
          <td><p>An error will be raised for nonsensical x or y values</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://random.imagecdn.app/500/150&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bbox</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;y0&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;x1&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;y1&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_crop</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="o">**</span><span class="n">bbox</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(50, 100, 3)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_crop</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">x0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y1</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; crops an image (numpy array) given a bounding box coordinates</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		x0: top left x value</span>
<span class="sd">		y0: top left y value</span>
<span class="sd">		x1: bottom right x value</span>
<span class="sd">		y1: bottom right y value</span>

<span class="sd">	Returns:</span>
<span class="sd">		An Image representation in an numpy array</span>

<span class="sd">	Raises:</span>
<span class="sd">		AssertionError: An error will be raised for nonsensical x or y values</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im = get_im(&quot;https://random.imagecdn.app/500/150&quot;)</span>
<span class="sd">		&gt;&gt;&gt; bbox = {&#39;x0&#39;: 100, &#39;y0&#39;: 50, &#39;x1&#39;: 200, &#39;y1&#39;: 100}</span>
<span class="sd">		&gt;&gt;&gt; im_crop(im, **bbox).shape</span>
<span class="sd">		(50, 100, 3)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">im_rgb_array</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
	<span class="k">assert</span> <span class="n">x1</span><span class="o">&gt;</span> <span class="n">x0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;x1 (</span><span class="si">{</span><span class="n">x1</span><span class="si">}</span><span class="s1">) cannot be greater than x0 (</span><span class="si">{</span><span class="n">x0</span><span class="si">}</span><span class="s1">)&#39;</span>
	<span class="k">assert</span> <span class="n">y1</span><span class="o">&gt;</span> <span class="n">y0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;y1 (</span><span class="si">{</span><span class="n">y1</span><span class="si">}</span><span class="s1">) cannot be greater than y0 (</span><span class="si">{</span><span class="n">y0</span><span class="si">}</span><span class="s1">)&#39;</span>
	<span class="n">h</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">im_rgb_array</span><span class="o">.</span><span class="n">shape</span>
	<span class="k">assert</span> <span class="n">h</span><span class="o">&gt;</span><span class="n">y0</span> <span class="ow">and</span> <span class="n">w</span><span class="o">&gt;</span><span class="n">x0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;x0 (</span><span class="si">{</span><span class="n">x0</span><span class="si">}</span><span class="s1">) or y0 (</span><span class="si">{</span><span class="n">y0</span><span class="si">}</span><span class="s1">) number out of bound w: </span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s1">; h: </span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s1">&#39;</span>
	<span class="k">return</span> <span class="n">im_rgb_array</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y0</span><span class="p">):</span> <span class="nb">int</span><span class="p">(</span><span class="n">y1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x0</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="p">:]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_draw_bbox">
<code class="highlight language-python"><span class="n">im_draw_bbox</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_bbv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbv_label_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>returns a numpy image of an image with bounding box drawn on top</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>x0</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>bounding box top-left x location</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y0</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>bounding box top-left y location</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>x1</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>bounding box bottom-right x location</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y1</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>bounding box bottom-right y location</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>color</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p><a href="https://www.w3schools.com/colors/colors_names.asp">HTML color name</a> as supported by <a href="https://pillow.readthedocs.io/en/stable/reference/ImageColor.html">PIL's ImageColor</a></p></td>
          <td>
                <code>&#39;black&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>width of the bounding box lines</p></td>
          <td>
                <code>3</code>
          </td>
        </tr>
        <tr>
          <td><code>caption</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>label for the bounding box</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>use_bbv</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>use the package <a href="https://github.com/shoumikchow/bbox-visualizer"><code>bbox_visualizer</code></a> instead of PIL</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>bbv_label_only</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>draw flag with label on the bounding box's centroid only</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bbox</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;y0&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;x1&#39;</span><span class="p">:</span> <span class="mi">190</span><span class="p">,</span> <span class="s1">&#39;y1&#39;</span><span class="p">:</span> <span class="mi">290</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_with_bbox</span> <span class="o">=</span> <span class="n">im_draw_bbox</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">caption</span> <span class="o">=</span> <span class="s2">&quot;hello world&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">bbox</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simple_im_diff</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">im_with_bbox</span><span class="p">)</span>
<span class="go">True</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_draw_bbox</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">x0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y1</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
		<span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">caption</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
		<span class="n">use_bbv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bbv_label_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
	<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; returns a numpy image of an image with bounding box drawn on top</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		x0: bounding box top-left x location</span>
<span class="sd">		y0: bounding box top-left y location</span>
<span class="sd">		x1: bounding box bottom-right x location</span>
<span class="sd">		y1: bounding box bottom-right y location</span>
<span class="sd">		color: [HTML color name](https://www.w3schools.com/colors/colors_names.asp) as supported by [PIL&#39;s ImageColor](https://pillow.readthedocs.io/en/stable/reference/ImageColor.html)</span>
<span class="sd">		width: width of the bounding box lines</span>
<span class="sd">		caption: label for the bounding box</span>
<span class="sd">		use_bbv: use the package [`bbox_visualizer`](https://github.com/shoumikchow/bbox-visualizer) instead of PIL</span>
<span class="sd">		bbv_label_only: draw flag with label on the bounding box&#39;s centroid only</span>

<span class="sd">	Returns:</span>
<span class="sd">		a numpy array</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im = get_im(&quot;https://picsum.photos/200/300&quot;)</span>
<span class="sd">		&gt;&gt;&gt; bbox = {&#39;x0&#39;: 10, &#39;y0&#39;: 10, &#39;x1&#39;: 190, &#39;y1&#39;: 290}</span>
<span class="sd">		&gt;&gt;&gt; im_with_bbox = im_draw_bbox(im, caption = &quot;hello world&quot;, **bbox)</span>
<span class="sd">		&gt;&gt;&gt; simple_im_diff(im, im_with_bbox)</span>
<span class="sd">		True</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x0</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y0</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">use_bbv</span><span class="p">:</span>
		<span class="kn">import</span> <span class="nn">bbox_visualizer</span> <span class="k">as</span> <span class="nn">bbv</span>
		<span class="n">im</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">bbv_label_only</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">caption</span><span class="p">:</span>
				<span class="n">im_array</span> <span class="o">=</span> <span class="n">bbv</span><span class="o">.</span><span class="n">draw_flag_with_label</span><span class="p">(</span><span class="n">im</span><span class="p">,</span>
								<span class="n">label</span> <span class="o">=</span> <span class="n">caption</span><span class="p">,</span>
								<span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">],</span>
								<span class="n">line_color</span> <span class="o">=</span> <span class="n">ImageColor</span><span class="o">.</span><span class="n">getrgb</span><span class="p">(</span><span class="n">color</span><span class="p">),</span>
								<span class="n">text_bg_color</span> <span class="o">=</span> <span class="n">ImageColor</span><span class="o">.</span><span class="n">getrgb</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
							<span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;im_draw_bbox: bbv_label_only is True but caption is None&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">im_array</span> <span class="o">=</span> <span class="n">bbv</span><span class="o">.</span><span class="n">draw_rectangle</span><span class="p">(</span><span class="n">im</span><span class="p">,</span>
							<span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span>
							<span class="n">bbox_color</span> <span class="o">=</span> <span class="n">ImageColor</span><span class="o">.</span><span class="n">getrgb</span><span class="p">(</span><span class="n">color</span><span class="p">),</span>
							<span class="n">thickness</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
						<span class="p">)</span>
			<span class="n">im_array</span> <span class="o">=</span> <span class="n">bbv</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="n">im_array</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">caption</span><span class="p">,</span>
							<span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">],</span>
							<span class="n">text_bg_color</span> <span class="o">=</span> <span class="n">ImageColor</span><span class="o">.</span><span class="n">getrgb</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
						<span class="p">)</span> <span class="k">if</span> <span class="n">caption</span> <span class="k">else</span> <span class="n">im_array</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">pil_im</span> <span class="o">=</span> <span class="n">get_pil_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">pil_im</span><span class="p">)</span>
		<span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">([(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)],</span> <span class="n">outline</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">caption</span><span class="p">:</span>
			<span class="n">pil_im</span> <span class="o">=</span> <span class="n">im_write_text</span><span class="p">(</span><span class="n">pil_im</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">caption</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y0</span><span class="p">,</span>
						<span class="n">tup_font_rgb</span><span class="o">=</span> <span class="n">ImageColor</span><span class="o">.</span><span class="n">getrgb</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
		<span class="n">im_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pil_im</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">im_array</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_isgray">
<code class="highlight language-python"><span class="n">im_isgray</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">b_check_rgb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p><a href="https://stackoverflow.com/a/58791118/14285096">check if an image is grayscale</a></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>b_check_rgb</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>check all the pixels if the image has 3 channels</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>True or False</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300?grayscale&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_isgray</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">b_check_rgb</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_isgray</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">,</span> <span class="n">b_check_rgb</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="go">False</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_isgray</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">b_check_rgb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; [check if an image is grayscale](https://stackoverflow.com/a/58791118/14285096)</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		b_check_rgb: check all the pixels if the image has 3 channels</span>

<span class="sd">	Returns:</span>
<span class="sd">		True or False</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im = get_im(&quot;https://picsum.photos/200/300?grayscale&quot;)</span>
<span class="sd">		&gt;&gt;&gt; im_isgray(im, b_check_rgb = False)</span>
<span class="sd">		True</span>
<span class="sd">		&gt;&gt;&gt; im_isgray(&quot;https://picsum.photos/200/300&quot;, b_check_rgb = True)</span>
<span class="sd">		False</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">im_rgb_array</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">im_rgb_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
	<span class="k">if</span> <span class="n">im_rgb_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
	<span class="k">if</span> <span class="n">b_check_rgb</span><span class="p">:</span>
		<span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">im_rgb_array</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">im_rgb_array</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">im_rgb_array</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">==</span><span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b</span><span class="o">==</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span> <span class="k">return</span> <span class="kc">True</span>
	<span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_mask_bbox">
<code class="highlight language-python"><span class="n">im_mask_bbox</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">l_bboxes</span><span class="p">,</span> <span class="n">mask_rgb_tup</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">b_mask_bg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Mask the input image with the provided bounding boxes</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>l_bboxes</code></td>
          <td>
                <code><span title="typing.List">List</span>[dict]</code>
          </td>
          <td><p>List of bounding boxes</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mask_rgb_tup</code></td>
          <td>
                <code><span title="typing.Tuple">Tuple</span>[int, int, int]</code>
          </td>
          <td><p>tuple of mask rgb value</p></td>
          <td>
                <code>(0, 0, 0)</code>
          </td>
        </tr>
        <tr>
          <td><code>b_mask_bg</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True area outside the bounding boxes will be set to mask_rgb; otherwise, the area inside the bounding boxes will be set to mask_rgb</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im_org</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bbox</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;y0&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;x1&#39;</span><span class="p">:</span> <span class="mi">190</span><span class="p">,</span> <span class="s1">&#39;y1&#39;</span><span class="p">:</span> <span class="mi">290</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_masked</span> <span class="o">=</span> <span class="n">im_mask_bbox</span><span class="p">(</span><span class="n">im_org</span><span class="p">,</span> <span class="n">l_bboxes</span><span class="o">=</span> <span class="p">[</span><span class="n">bbox</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simple_im_diff</span><span class="p">(</span><span class="n">im_org</span><span class="p">,</span> <span class="n">im_masked</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_org</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">im_masked</span><span class="o">.</span><span class="n">shape</span>
<span class="go">True</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_mask_bbox</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">l_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
		<span class="n">mask_rgb_tup</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
		<span class="n">b_mask_bg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
	<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; Mask the input image with the provided bounding boxes</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		l_bboxes: List of bounding boxes</span>
<span class="sd">		mask_rgb_tup: tuple of mask rgb value</span>
<span class="sd">		b_mask_bg: if True area outside the bounding boxes will be set to mask_rgb; otherwise, the area inside the bounding boxes will be set to mask_rgb</span>

<span class="sd">	Returns:</span>
<span class="sd">		a numpy array</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im_org = get_im(&quot;https://picsum.photos/200/300&quot;)</span>
<span class="sd">		&gt;&gt;&gt; bbox = {&#39;x0&#39;: 10, &#39;y0&#39;: 10, &#39;x1&#39;: 190, &#39;y1&#39;: 290}</span>
<span class="sd">		&gt;&gt;&gt; im_masked = im_mask_bbox(im_org, l_bboxes= [bbox])</span>
<span class="sd">		&gt;&gt;&gt; simple_im_diff(im_org, im_masked)</span>
<span class="sd">		True</span>
<span class="sd">		&gt;&gt;&gt; im_org.shape == im_masked.shape</span>
<span class="sd">		True</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">im_rgb_array</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
	<span class="n">h</span><span class="p">,</span><span class="n">w</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">im_rgb_array</span><span class="o">.</span><span class="n">shape</span>
	<span class="n">bg_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="c1"># black</span>
	<span class="n">bg_im</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">mask_rgb_tup</span> <span class="c1"># apply color</span>
	<span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">im_rgb_array</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">l_bboxes</span><span class="p">:</span>
		<span class="n">bg_im</span><span class="p">[</span><span class="n">bbox</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]:</span> <span class="n">bbox</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]:</span> <span class="n">bbox</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">im_crop</span><span class="p">(</span><span class="n">im_rgb_array</span><span class="p">,</span> <span class="o">**</span><span class="n">bbox</span><span class="p">)</span>
		<span class="n">im</span><span class="p">[</span><span class="n">bbox</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]:</span> <span class="n">bbox</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]:</span> <span class="n">bbox</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mask_rgb_tup</span>
	<span class="k">return</span> <span class="n">bg_im</span> <span class="k">if</span> <span class="n">b_mask_bg</span> <span class="k">else</span> <span class="n">im</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_max_long_edge">
<code class="highlight language-python"><span class="n">im_max_long_edge</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">long_edge</span><span class="p">,</span> <span class="n">resample_algo</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return an image whose long edge is no longer than the given size</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>resample_algo</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>default to LANCZOS because it gives <a href="https://pillow.readthedocs.io/en/stable/handbook/concepts.html#filters-comparison-table">the best downscaling quality</a></p></td>
          <td>
                <code>Image.LANCZOS</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_max_long_edge</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">long_edge</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(300, 200, 3)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_max_long_edge</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">long_edge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
		<span class="n">resample_algo</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; Return an image whose long edge is no longer than the given size</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		resample_algo: default to LANCZOS because it gives [the best downscaling quality](https://pillow.readthedocs.io/en/stable/handbook/concepts.html#filters-comparison-table)</span>

<span class="sd">	Returns:</span>
<span class="sd">		a numpy array</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im = get_im(&quot;https://picsum.photos/200/300&quot;)</span>
<span class="sd">		&gt;&gt;&gt; im_max_long_edge(im, long_edge = 500).shape</span>
<span class="sd">		(300, 200, 3)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">propose_wh</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">max_long_edge</span> <span class="o">=</span> <span class="n">long_edge</span><span class="p">)</span>
	<span class="n">im</span> <span class="o">=</span> <span class="n">get_pil_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">),</span> <span class="n">resample</span> <span class="o">=</span> <span class="n">resample_algo</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_min_short_edge">
<code class="highlight language-python"><span class="n">im_min_short_edge</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">short_edge</span><span class="p">,</span> <span class="n">resample_algo</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return an image whose short edge is no shorter than the given size</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>resample_algo</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>default to LANCZOS because it gives <a href="https://pillow.readthedocs.io/en/stable/handbook/concepts.html#filters-comparison-table">the best downscaling quality</a></p></td>
          <td>
                <code>Image.LANCZOS</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_min_short_edge</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">short_edge</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(450, 300, 3)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_min_short_edge</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">short_edge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
		<span class="n">resample_algo</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; Return an image whose short edge is no shorter than the given size</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		resample_algo: default to LANCZOS because it gives [the best downscaling quality](https://pillow.readthedocs.io/en/stable/handbook/concepts.html#filters-comparison-table)</span>

<span class="sd">	Returns:</span>
<span class="sd">		a numpy array</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im = get_im(&quot;https://picsum.photos/200/300&quot;)</span>
<span class="sd">		&gt;&gt;&gt; im_min_short_edge(im, short_edge = 300).shape</span>
<span class="sd">		(450, 300, 3)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">propose_wh</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">min_short_edge</span> <span class="o">=</span> <span class="n">short_edge</span><span class="p">)</span>
	<span class="n">im</span> <span class="o">=</span> <span class="n">get_pil_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">),</span> <span class="n">resample</span> <span class="o">=</span> <span class="n">resample_algo</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_to_bytes">
<code class="highlight language-python"><span class="n">im_to_bytes</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns an Image representation in bytes format</p>
<p>This function creates a mutable bytearray object and uses the <code>PIL.Image.save()</code> function
to output the image to it. Note that the <code>PIL.Image.tobytes()</code> is <a href="https://stackoverflow.com/a/58949303/14285096">not recommended</a>.
For more on working with binary data, see <a href="https://www.devdungeon.com/content/working-binary-data-python#video_bytes_bytearray">here</a>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>format</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>image format as <a href="https://pillow.readthedocs.io/en/stable/handbook/image-file-formats.html">supported by PIL</a></p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>quality</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, str]</code>
          </td>
          <td><p>compression quality passed to <code>Image.save()</code>, defaults to "keep" (retain image quality, only for JPEG format); more details available <a href="https://pillow.readthedocs.io/en/stable/handbook/image-file-formats.html#jpeg-saving">here</a></p></td>
          <td>
                <code>&#39;keep&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bytes</code>
          </td>
          <td><p>a bytes representation of the provide image</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im_bytes</span> <span class="o">=</span> <span class="n">im_to_bytes</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">im_bytes</span><span class="p">)</span><span class="o">==</span> <span class="nb">bytes</span>
<span class="go">True</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_to_bytes</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quality</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;keep&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; Returns an Image representation in bytes format</span>

<span class="sd">	This function creates a mutable bytearray object and uses the `PIL.Image.save()` function</span>
<span class="sd">	to output the image to it. Note that the `PIL.Image.tobytes()` is [not recommended](https://stackoverflow.com/a/58949303/14285096).</span>
<span class="sd">	For more on working with binary data, see [here](https://www.devdungeon.com/content/working-binary-data-python#video_bytes_bytearray).</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		format: image format as [supported by PIL](https://pillow.readthedocs.io/en/stable/handbook/image-file-formats.html)</span>
<span class="sd">		quality: compression quality passed to `Image.save()`, defaults to &quot;keep&quot; (retain image quality, only for JPEG format); more details available [here](https://pillow.readthedocs.io/en/stable/handbook/image-file-formats.html#jpeg-saving)</span>

<span class="sd">	Returns:</span>
<span class="sd">		a bytes representation of the provide image</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im_bytes = im_to_bytes(&quot;https://picsum.photos/200/300&quot;)</span>
<span class="sd">		&gt;&gt;&gt; type(im_bytes)== bytes</span>
<span class="sd">		True</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">imgByteArr</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
	<span class="n">pil_im</span> <span class="o">=</span> <span class="n">get_pil_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>

	<span class="c1"># from the PIL doc:</span>
	<span class="c1"># If a file object was used instead of a filename, this parameter should always be used.</span>
	<span class="n">img_format</span> <span class="o">=</span> <span class="nb">format</span> <span class="k">if</span> <span class="nb">format</span> <span class="k">else</span> <span class="n">pil_im</span><span class="o">.</span><span class="n">format</span>
	<span class="n">img_format</span> <span class="o">=</span> <span class="n">img_format</span> <span class="k">if</span> <span class="n">img_format</span> <span class="k">else</span> <span class="s1">&#39;jpeg&#39;</span>
	<span class="n">pil_im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">imgByteArr</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">img_format</span><span class="p">,</span> <span class="n">quality</span> <span class="o">=</span> <span class="n">quality</span><span class="p">)</span>
	<span class="n">imgByteArr</span> <span class="o">=</span> <span class="n">imgByteArr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">imgByteArr</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.im_write_text">
<code class="highlight language-python"><span class="n">im_write_text</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tup_font_rgb</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">tup_bg_rgb</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>draw text over image and returns it as a numpy array</p>
<p>font_size is not currently supported because PIL's default font
<a href="https://github.com/python-pillow/Pillow/issues/6622">cannot change in size</a>;
for simplicity, the work-arounds (such as <a href="https://stackoverflow.com/a/48381516/14285096">this</a>)
is not implemented.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to be written</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>text's top-left x location</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>text's top-left y location</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tup_font_rgb</code></td>
          <td>
                <code><span title="typing.Tuple">Tuple</span>[int, int, int]</code>
          </td>
          <td><p>RGB values for font color, defaults to white</p></td>
          <td>
                <code>(255, 255, 255)</code>
          </td>
        </tr>
        <tr>
          <td><code>tup_bg_rgb</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.Tuple">Tuple</span>[int, int, int], None]</code>
          </td>
          <td><p>RGB values for text's background color</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_with_text</span> <span class="o">=</span> <span class="n">im_write_text</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;hello world&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simple_im_diff</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">im_with_text</span><span class="p">)</span>
<span class="go">True</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">im_write_text</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
		<span class="n">tup_font_rgb</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
		<span class="n">tup_bg_rgb</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
	<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; draw text over image and returns it as a numpy array</span>

<span class="sd">	font_size is not currently supported because PIL&#39;s default font</span>
<span class="sd">	[cannot change in size](https://github.com/python-pillow/Pillow/issues/6622);</span>
<span class="sd">	for simplicity, the work-arounds (such as [this](https://stackoverflow.com/a/48381516/14285096))</span>
<span class="sd">	is not implemented.</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		text: text to be written</span>
<span class="sd">		x: text&#39;s top-left x location</span>
<span class="sd">		y: text&#39;s top-left y location</span>
<span class="sd">		tup_font_rgb: RGB values for font color, defaults to white</span>
<span class="sd">		tup_bg_rgb: RGB values for text&#39;s background color</span>

<span class="sd">	Returns:</span>
<span class="sd">		a numpy array</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im = get_im(&quot;https://picsum.photos/200/300&quot;)</span>
<span class="sd">		&gt;&gt;&gt; im_with_text = im_write_text(im, text = &quot;hello world&quot;, x = 10, y = 10)</span>
<span class="sd">		&gt;&gt;&gt; simple_im_diff(im, im_with_text)</span>
<span class="sd">		True</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">pil_im</span> <span class="o">=</span> <span class="n">get_pil_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

	<span class="c1"># font = ImageFont.truetype(font_path, size = font_size, encoding = &#39;unic&#39;)</span>
	<span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">load_default</span><span class="p">()</span>
	<span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">pil_im</span><span class="p">)</span>
	<span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">textsize</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tup_bg_rgb</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
		<span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">xy</span> <span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">tup_bg_rgb</span><span class="p">,</span> <span class="n">outline</span> <span class="o">=</span> <span class="n">tup_bg_rgb</span><span class="p">)</span>
	<span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">text</span><span class="p">,</span> <span class="n">tup_font_rgb</span><span class="p">,</span> <span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pil_im</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.image_stack">
<code class="highlight language-python"><span class="n">image_stack</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">im2</span><span class="p">,</span> <span class="n">do_vstack</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">split_pct</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">black_line_thickness</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Concat two images into one with a border separating the two</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im1</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>the left or top image</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>im2</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>the right or bottom image (will be resize to match im1's dimension); <strong>Aspect ratio</strong> might change!</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>do_vstack</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>do vertical stack, else, horizontal stack</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>split_pct</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Percentage of left image to show, right image will fill up the remainder. If none, both left and right images will be shown in full</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>black_line_thickness</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>how many pixels wide is the black line separating the two images</p></td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>resample</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>one of <a href="https://note.nkmk.me/en/python-pillow-image-resize/">PIL Image resampling methods</a></p></td>
          <td>
                <code>Image.LANCZOS</code>
          </td>
        </tr>
        <tr>
          <td><code>debug</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>print out which combine algo will be used on the two resized images</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>a numpy array</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>AssertionError</code>
          </td>
          <td><p>An error will be raise split_pct is greater than or equal to one</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">im1</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im2</span> <span class="o">=</span> <span class="n">get_pil_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/500&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image_stack</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">im2</span><span class="p">,</span> <span class="n">do_vstack</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">black_line_thickness</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(805, 200, 3)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">image_stack</span><span class="p">(</span><span class="n">im1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">im2</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">do_vstack</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">split_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
				<span class="n">black_line_thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
				<span class="n">resample</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
	<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; Concat two images into one with a border separating the two</span>

<span class="sd">	Args:</span>
<span class="sd">		im1: the left or top image</span>
<span class="sd">		im2: the right or bottom image (will be resize to match im1&#39;s dimension); **Aspect ratio** might change!</span>
<span class="sd">		do_vstack: do vertical stack, else, horizontal stack</span>
<span class="sd">		split_pct: Percentage of left image to show, right image will fill up the remainder. If none, both left and right images will be shown in full</span>
<span class="sd">		black_line_thickness: how many pixels wide is the black line separating the two images</span>
<span class="sd">		resample: one of [PIL Image resampling methods](https://note.nkmk.me/en/python-pillow-image-resize/)</span>
<span class="sd">		debug: print out which combine algo will be used on the two resized images</span>

<span class="sd">	Returns:</span>
<span class="sd">		a numpy array</span>

<span class="sd">	Raises:</span>
<span class="sd">		AssertionError: An error will be raise split_pct is greater than or equal to one</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; im1 = get_im(&quot;https://picsum.photos/200/300&quot;)</span>
<span class="sd">		&gt;&gt;&gt; im2 = get_pil_im(&quot;https://picsum.photos/200/500&quot;)</span>
<span class="sd">		&gt;&gt;&gt; image_stack(im1, im2, do_vstack = True, black_line_thickness = 5).shape</span>
<span class="sd">		(805, 200, 3)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="c1"># input validation</span>
	<span class="k">if</span> <span class="n">split_pct</span><span class="p">:</span>
		<span class="k">assert</span> <span class="n">split_pct</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;split_pct must be float and less than or equal to 1.&quot;</span>

	<span class="n">img_arr_1</span><span class="p">,</span> <span class="n">img_arr_2</span> <span class="o">=</span> <span class="n">get_im</span><span class="p">(</span><span class="n">im1</span><span class="p">),</span> <span class="n">get_im</span><span class="p">(</span><span class="n">im2</span><span class="p">)</span>
	<span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">img_arr_1</span><span class="o">.</span><span class="n">shape</span>
	<span class="n">_h</span><span class="p">,</span> <span class="n">_w</span><span class="p">,</span> <span class="n">_c</span> <span class="o">=</span> <span class="n">img_arr_2</span><span class="o">.</span><span class="n">shape</span>
	<span class="k">if</span> <span class="n">do_vstack</span><span class="p">:</span>
		<span class="n">_h</span> <span class="o">*=</span> <span class="n">w</span><span class="o">/</span> <span class="n">_w</span>
		<span class="n">_w</span> <span class="o">=</span> <span class="n">w</span>
		<span class="n">np_black_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">black_line_thickness</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">_w</span> <span class="o">*=</span> <span class="n">h</span><span class="o">/</span> <span class="n">_h</span>
		<span class="n">_h</span> <span class="o">=</span> <span class="n">h</span>
		<span class="n">np_black_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">black_line_thickness</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

	<span class="c1"># image resize operation</span>
	<span class="n">a_end</span> <span class="o">=</span> <span class="n">split_pct</span> <span class="k">if</span> <span class="n">split_pct</span> <span class="k">else</span> <span class="mi">1</span>
	<span class="n">b_start</span> <span class="o">=</span> <span class="n">split_pct</span> <span class="k">if</span> <span class="n">split_pct</span> <span class="k">else</span> <span class="mi">0</span>

	<span class="n">b_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img_arr_2</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">_w</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">_h</span><span class="p">)),</span> <span class="n">resample</span> <span class="o">=</span> <span class="n">resample</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">do_vstack</span><span class="p">:</span>
		<span class="n">a_img</span> <span class="o">=</span> <span class="n">img_arr_1</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">a_end</span> <span class="p">),</span> <span class="p">:,</span> <span class="p">:]</span>
		<span class="n">b_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b_img</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">_h</span> <span class="o">*</span> <span class="n">b_start</span><span class="p">):,:,:]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">a_img</span> <span class="o">=</span> <span class="n">img_arr_1</span><span class="p">[:,</span> <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">a_end</span> <span class="p">),</span> <span class="p">:]</span>
		<span class="n">b_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b_img</span><span class="p">)[:,</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">b_start</span><span class="p">):,:]</span>

	<span class="c1"># alpha channel</span>
	<span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">_c</span><span class="p">:</span>
		<span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;image_stack: img_arr_1 channel </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1"> and img_arr_2 </span><span class="si">{</span><span class="n">_c</span><span class="si">}</span><span class="s1"> does not match. adding alpha to both.&#39;</span><span class="p">)</span>
		<span class="n">a_img</span> <span class="o">=</span> <span class="n">im_add_alpha</span><span class="p">(</span><span class="n">a_img</span><span class="p">)</span>
		<span class="n">b_img</span> <span class="o">=</span> <span class="n">im_add_alpha</span><span class="p">(</span><span class="n">b_img</span><span class="p">)</span>
		<span class="n">np_black_line</span> <span class="o">=</span> <span class="n">im_add_alpha</span><span class="p">(</span><span class="n">np_black_line</span><span class="p">)</span>

	<span class="n">np_func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span> <span class="k">if</span> <span class="n">do_vstack</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span>
	<span class="n">img_comb</span> <span class="o">=</span> <span class="n">np_func</span><span class="p">([</span><span class="n">a_img</span><span class="p">,</span> <span class="n">np_black_line</span><span class="p">,</span> <span class="n">b_img</span><span class="p">])</span>
	<span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;applied </span><span class="si">{</span><span class="n">np_func</span><span class="si">}</span><span class="s1"> on im1 (shape: </span><span class="si">{</span><span class="n">a_img</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">) and im2 (shape: </span><span class="si">{</span><span class="n">b_img</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">img_comb</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.pil_im_gray2rgb">
<code class="highlight language-python"><span class="n">pil_im_gray2rgb</span><span class="p">(</span><span class="n">pil_im</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>convert a grayscale Pillow Image to RGB format</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pil_im</code></td>
          <td>
                <code><span title="PIL.Image">Image</span>.<span title="PIL.Image.Image">Image</span></code>
          </td>
          <td><p>a PIL Image Object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="PIL.Image">Image</span>.<span title="PIL.Image.Image">Image</span></code>
          </td>
          <td><p>A PIL Image Object in RGB format</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">pil_im</span> <span class="o">=</span> <span class="n">get_pil_im</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300?grayscale&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pil_im</span> <span class="o">=</span> <span class="n">pil_im_gray2rgb</span><span class="p">(</span><span class="n">pil_im</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">im_isgray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pil_im</span><span class="p">),</span> <span class="n">b_check_rgb</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">False</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pil_im_gray2rgb</span><span class="p">(</span><span class="n">pil_im</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; convert a grayscale Pillow Image to RGB format</span>

<span class="sd">	Args:</span>
<span class="sd">		pil_im: a PIL Image Object</span>

<span class="sd">	Returns:</span>
<span class="sd">		A PIL Image Object in RGB format</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; pil_im = get_pil_im(&quot;https://picsum.photos/200/300?grayscale&quot;)</span>
<span class="sd">		&gt;&gt;&gt; pil_im = pil_im_gray2rgb(pil_im)</span>
<span class="sd">		&gt;&gt;&gt; im_isgray(np.array(pil_im), b_check_rgb = False)</span>
<span class="sd">		False</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">return</span> <span class="n">pil_im</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span>
			<span class="p">)</span> <span class="k">if</span> <span class="n">im_isgray</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pil_im</span><span class="p">),</span> <span class="n">b_check_rgb</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="k">else</span> <span class="n">pil_im</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.propose_wh">
<code class="highlight language-python"><span class="n">propose_wh</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">max_long_edge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_short_edge</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>returns a Tuple of Width and Height keeping the aspect ratio</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>an image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>max_long_edge</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>max long edge of the resized image</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>min_short_edge</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>min short edge of the resize image</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
          </td>
          <td><p>A Tuple of resized Width Hieght (keeping aspect ratio)</p></td>
        </tr>
    </tbody>
  </table>

<details class="raise">
  <summary>Raise</summary>
  <p>AssertionError: Either max_long_edge or min_short_edge must be provided but not both</p>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">propose_wh</span><span class="p">(</span><span class="s2">&quot;https://random.imagecdn.app/500/150&quot;</span><span class="p">,</span> <span class="n">max_long_edge</span> <span class="o">=</span> <span class="mi">250</span><span class="p">)</span>
<span class="go">(250, 75)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">propose_wh</span><span class="p">(</span><span class="s2">&quot;https://random.imagecdn.app/500/150&quot;</span><span class="p">,</span> <span class="n">min_short_edge</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="go">(500, 150)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">propose_wh</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Any</span> <span class="p">,</span> <span class="n">max_long_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_short_edge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
	<span class="sd">&#39;&#39;&#39; returns a Tuple of Width and Height keeping the aspect ratio</span>

<span class="sd">	Args:</span>
<span class="sd">		im: an image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		max_long_edge: max long edge of the resized image</span>
<span class="sd">		min_short_edge: min short edge of the resize image</span>

<span class="sd">	Returns:</span>
<span class="sd">		A Tuple of resized Width Hieght (keeping aspect ratio)</span>

<span class="sd">	Raise:</span>
<span class="sd">		AssertionError: Either max_long_edge or min_short_edge must be provided but not both</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; propose_wh(&quot;https://random.imagecdn.app/500/150&quot;, max_long_edge = 250)</span>
<span class="sd">		(250, 75)</span>
<span class="sd">		&gt;&gt;&gt; propose_wh(&quot;https://random.imagecdn.app/500/150&quot;, min_short_edge = 100)</span>
<span class="sd">		(500, 150)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">assert</span> <span class="nb">any</span><span class="p">([</span><span class="n">max_long_edge</span><span class="p">,</span> <span class="n">min_short_edge</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">max_long_edge</span><span class="p">,</span> <span class="n">min_short_edge</span><span class="p">])),</span> \
		<span class="sa">f</span><span class="s2">&quot;Either max_long_edge or min_short_edge must be provided but not both&quot;</span>

	<span class="n">w_</span> <span class="p">,</span> <span class="n">h_</span> <span class="o">=</span> <span class="n">get_pil_im</span><span class="p">(</span><span class="n">im</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
	<span class="n">wh_ratio</span> <span class="o">=</span> <span class="n">w_</span><span class="o">/</span><span class="n">h_</span>
	<span class="k">if</span> <span class="n">w_</span> <span class="o">&gt;</span> <span class="n">h_</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">max_long_edge</span><span class="p">:</span>
			<span class="n">w</span> <span class="o">=</span> <span class="n">max_long_edge</span> <span class="k">if</span> <span class="n">w_</span> <span class="o">&gt;</span> <span class="n">max_long_edge</span> <span class="k">else</span> <span class="n">w_</span>
			<span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="n">wh_ratio</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">h</span> <span class="o">=</span> <span class="n">min_short_edge</span> <span class="k">if</span> <span class="n">h_</span> <span class="o">&lt;</span> <span class="n">min_short_edge</span> <span class="k">else</span> <span class="n">h_</span>
			<span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">wh_ratio</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">max_long_edge</span><span class="p">:</span>
			<span class="n">h</span> <span class="o">=</span> <span class="n">max_long_edge</span> <span class="k">if</span> <span class="n">h_</span> <span class="o">&gt;</span> <span class="n">max_long_edge</span> <span class="k">else</span> <span class="n">h_</span>
			<span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">wh_ratio</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">w</span> <span class="o">=</span> <span class="n">min_short_edge</span> <span class="k">if</span> <span class="n">w_</span> <span class="o">&lt;</span> <span class="n">min_short_edge</span> <span class="k">else</span> <span class="n">w_</span>
			<span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="n">wh_ratio</span><span class="p">)</span>
	<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 class="doc doc-heading" id="toolbox.im_utils.simple_im_diff">
<code class="highlight language-python"><span class="n">simple_im_diff</span><span class="p">(</span><span class="n">im_1</span><span class="p">,</span> <span class="n">im_2</span><span class="p">,</span> <span class="n">n_pixels_allowed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>compare two images and check for pixel differences <a href="https://stackoverflow.com/a/73433784/14285096">using PIL</a></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>im_1</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>first image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>im_2</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>second image representation in numpy array, PIL Image object, URL, or filepath</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_pixels_allowed</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>threshold to number of pixel difference allowed between im_1 and im_2</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>True if two images are different (above <code>n_pixels_allowed</code>) and False otherwise</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">simple_im_diff</span><span class="p">(</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">,</span><span class="s2">&quot;https://picsum.photos/200/300&quot;</span><span class="p">)</span>
<span class="go">True</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>toolbox/im_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">simple_im_diff</span><span class="p">(</span><span class="n">im_1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">im_2</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">n_pixels_allowed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
	<span class="sd">&#39;&#39;&#39; compare two images and check for pixel differences [using PIL](https://stackoverflow.com/a/73433784/14285096)</span>

<span class="sd">	Args:</span>
<span class="sd">		im_1: first image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		im_2: second image representation in numpy array, PIL Image object, URL, or filepath</span>
<span class="sd">		n_pixels_allowed: threshold to number of pixel difference allowed between im_1 and im_2</span>

<span class="sd">	Returns:</span>
<span class="sd">		True if two images are different (above `n_pixels_allowed`) and False otherwise</span>

<span class="sd">	Examples:</span>
<span class="sd">		&gt;&gt;&gt; simple_im_diff(&quot;https://picsum.photos/200/300&quot;,&quot;https://picsum.photos/200/300&quot;)</span>
<span class="sd">		True</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">if</span> <span class="n">get_im</span><span class="p">(</span><span class="n">im_1</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">get_im</span><span class="p">(</span><span class="n">im_2</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>

	<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">ImageChops</span>
	<span class="n">im_1</span><span class="p">,</span> <span class="n">im_2</span> <span class="o">=</span> <span class="n">get_pil_im</span><span class="p">(</span><span class="n">im_1</span><span class="p">),</span> <span class="n">get_pil_im</span><span class="p">(</span><span class="n">im_2</span><span class="p">)</span>
	<span class="n">diff</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">im_1</span><span class="p">,</span><span class="n">im_2</span><span class="p">)</span>
	<span class="n">channels</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">getdata</span><span class="p">()))</span><span class="o">&gt;</span> <span class="n">n_pixels_allowed</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
	<span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../how-to-guides/" class="md-footer__link md-footer__link--prev" aria-label="Previous: How to Guides" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              How to Guides
            </div>
          </div>
        </a>
      
      
        
        <a href="../examples/im_utils/" class="md-footer__link md-footer__link--next" aria-label="Next: Image Utilities Examples" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Image Utilities Examples
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>